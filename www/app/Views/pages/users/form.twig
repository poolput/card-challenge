{% extends "layout/index.html" %}
{% block head %}
{{ parent() }}
{% endblock %}
{% block content %}

<div class="pcoded-content">
	<div class="pcoded-inner-content">
		<div class="main-body">
			<div class="page-wrapper">
				<div class="page-header">
					<div class="row align-items-end">
						<div class="col-lg-4">
							<div class="page-header-breadcrumb">
								{{ breadcrumb|raw }}
							</div>
						</div>
						<div class="col-lg-8 text-right">
							<div class="page-header-title">
								<div class="d-inline">
									<h4>
										{{ title_body }}
									</h4>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="page-body">
					<div class="row">

						<div class="col-sm-12">
							<div class="card">
								<div class="card-block">
									{% if warning_exist is not empty %}
    									<div class="alert alert-warning background-warning">
    										<button type="button" class="close" data-dismiss="alert" aria-label="Close">
    											<i class="icofont icofont-close-line-circled text-white"></i>
    										</button>
    										<strong> </strong> {{ warning_exist }} 
    										<code>{{ post.email }}</code>
    									</div>
									{% endif %}
									<h4 class="sub-title">User Profile Inputs</h4>
									<form action="" method="post" autocomplete="on" id="form_user">
										<input type="hidden" name="user_id" id="user_id" value="{{ user.user_id }}">
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Company <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<select class="form-control" name="company_id" id="company_id">
													{% for company in companies %}
    													{% set selected = '' %}
    													{%  if company.company_id == user.company_id %}
    													    {% set selected = ' selected="selected" ' %}
    													{%  endif %}
														<option {{ selected }} value="{{ company.company_id }}">{{ company.company_name }}</option>
													{% endfor %}
												</select> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Branch <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<select class="form-control" name="branch_id" id="branch_id">
													<option value="">---select---</option>
													{% for branch in branchs %}
    													{% set selected = '' %}
    													{%  if branch.branch_id == user.branch_id %}
    													    {% set selected = ' selected="selected" ' %}
    													{%  endif %}
    													<option {{ selected }} value="{{ branch.branch_id }}">{{ branch.branch_name }}</option>
													{% endfor %}
												</select> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Role <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<select class="form-control" name="role_id" id="role_id">
													<option value="">---select---</option>
													{% for role in roles %}
    													{% set selected = '' %}
    													{%  if role.role_id == user.role_id %}
    													    {% set selected = ' selected="selected" ' %}
    													{%  endif %}
    													<option {{ selected }} value="{{ role.role_id }}">{{ role.role_name }}</option>
													{% endfor %}
												</select> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Username <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<input type="text" class="form-control" name="user_name" id="user_name" value="{{ user.user_name }}"> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>

										<div class="form-group row {{ current_password }}">
											<label class="col-sm-2 col-form-label">Current password <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<input type="password" class="form-control" name="user_password_current" id="user_password_current" value=""> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label"> {{ password }} <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<input type="password" class="form-control" name="user_password" id="user_password" value=""> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Confirm password <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<input type="password" class="form-control" name="user_password_confirm" id="user_password_confirm" value=""> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">First name</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" name="first_name" id="first_name" value="{{ user.first_name }}">
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Last name</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" name="last_name" id="last_name" value="{{ user.last_name }}">
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Email <span class="text-danger error">*</span></label>
											<div class="col-sm-10">
												<input type="text" class="form-control" name="email" id="email" value="{{ user.email }}"> <span class="messages"><p class="text-danger error">
														{{ incurrect_message }}
													</p></span>
											</div>
										</div>
										<div class="row">
											<div class="col-md-12 text-right">
												<button type="button" class="btn btn-outline-secondary btn-cancel">Cancel</button>
												<button class="btn btn-secondary btn-save">&nbsp; Save &nbsp;</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}
{% block footer %}
{{ parent() }}
<script src="{{ base_url }}/theme/bower_components/i18next/js/i18next.min.js"></script>
<script src="{{ base_url }}/theme/bower_components/i18next-xhr-backend/js/i18nextXHRBackend.min.js"></script>
<script src="{{ base_url }}/theme/bower_components/i18next-browser-languagedetector/js/i18nextBrowserLanguageDetector.min.js"></script>
<script src="{{ base_url }}/theme/bower_components/jquery-i18next/js/jquery-i18next.min.js"></script>

<script src="{{ base_url }}/theme/assets/js/pcoded.min.js"></script>
<script src="{{ base_url }}/theme/assets/js/vartical-layout.min.js"></script>
<script src="{{ base_url }}/theme/assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="{{ base_url }}/theme/assets/js/script.js"></script>

<script>
    	$('#company_id').change(function(){
    		var company_id = $(this).val();
    		var url = '{{ base_url }}/get-branch';
    
    		$.post(url, {'company_id' : company_id,'type' : 'select'}, function(response) {
    			$('#branch_id').html(response);
    			triggerElementBranch();
    		});
    	});
    	function triggerElementBranch(){
    		$('#branch_id').change(function(){
    			var branch_id = $(this).val();
    			var url = '{{ base_url }}/get-role';
    			
    			$.post(url, {'branch_id' : branch_id}, function(response) {
    				$('#role_id').html(response);
    			});
    		});
    	}
    	function validate(){
        	$('.messages').hide();
        	
    		var company_id = $('#company_id').val();
    		var branch_id = $('#branch_id').val();
    		var role_id = $('#role_id').val();
    		var user_name = $('#user_name').val();
    		var user_password = $('#user_password').val();
    		var user_password_confirm = $('#user_password_confirm').val();
 
    		var email = $('#email').val();
    		var valid = 0;
    		
			if(!company_id){
				$('#company_id').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!branch_id){
				$('#branch_id').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!role_id){
				$('#role_id').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!user_name){
				$('#user_name').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!user_password){
				$('#user_password').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!user_password_confirm){
				$('#user_password_confirm').parent('div').find('.messages').show();
				valid = 1;
			}
			if(user_password != user_password_confirm){
				$('#user_password_confirm').parent('div').find('.messages').show();
				valid = 1;
			}
			if(!email){
				$('#email').parent('div').find('.messages').show();
				valid = 1;
			}
			var type = '{{ type }}';
			if(type == 'edit'){
				
				var url = '{{ base_url }}/get-user';
				var current_password = $('#user_password_current').val();
				var user_id = '{{ user.user_id }}';
    			$.post(url, {
    				'user_id' : user_id,
    				'password' : current_password
    			}, function(response) {
    				if (!response) {
    					$('#user_password_current').parent('div').find('.messages')
    							.show();
    					valid = 1;
    				}
    				if (valid != 1) {
    					$('#form_user').submit();
    				}
    			});
    			return false;
    		} else {
    			if (valid != 1) {
    				return true;
    			} else {
    				return false;
    			}
    		}
    	}
    	$('.btn-cancel').click(function() {
    		window.history.back();
    		return false;
    	});
    	
    	$('.btn-save').click(function() {
    		return validate();
    	});
</script>
{% endblock %}